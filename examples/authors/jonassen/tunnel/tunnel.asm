;***************************************************
; textured rotating/zooming tunnel
; for mc10 textmode
; coded by Simon Jonassen (2015)
;***************************************************
		.org		$5000
;***************************************************
; SG12
;***************************************************

start		ldd		#$4000
		std		scrpt+1

		ldx 		#angdep	
loop1		ldd		,x		;depth in A / angle in B
		inx
		inx
		stx		oldx+1
rotzoom		addd		#$0000
		andb		#$f0		;make sure it's upper 4 bits
		lsra
		lsra
		lsra
		lsra
		staa		smod1+1
smod1		orab		#0

		ldx		#tex	
		abx
		ldaa		,x

scrpt		ldx		#0000
			
store		staa		,x
		inx
		stx		scrpt+1
		cpx		#$4000+512
	
oldx		ldx		#0000
						
		blo		loop1

		


;***************************************************
; ROTATION
;***************************************************
		inc		rotzoom+2
;***************************************************
; ZOOM
;***************************************************
		inc		rotzoom+1
;***************************************************
		jmp		start

		

		.ORG  (($+0FFH) & 0FF00H)
;***************************************************
;texture 16*16 (256) chosen because it's
;easy to address with a single 8 bit register
;***************************************************
tex
	.byte	$cf,$80,$cf,$80,$cf,$80,$cf,$80,$cf,$80,$9f,$80,$9f,$80,$9f,$80
	.byte	$80,$cf,$80,$cf,$80,$cf,$80,$cf,$80,$9f,$80,$9f,$80,$9f,$80,$9f
	.byte	$cf,$80,$cf,$80,$cf,$80,$cf,$80,$cf,$80,$9f,$80,$9f,$80,$9f,$80
	.byte	$80,$cf,$80,$cf,$80,$cf,$80,$cf,$80,$9f,$80,$9f,$80,$9f,$80,$9f
	.byte	$cf,$80,$cf,$80,$cf,$80,$cf,$80,$cf,$80,$9f,$80,$9f,$80,$9f,$80
	.byte	$80,$cf,$80,$cf,$80,$cf,$80,$cf,$80,$9f,$80,$9f,$80,$9f,$80,$9f
	.byte	$cf,$80,$cf,$80,$cf,$80,$cf,$80,$cf,$80,$9f,$80,$9f,$80,$9f,$80
	.byte	$80,$cf,$80,$cf,$80,$cf,$80,$cf,$80,$9f,$80,$9f,$80,$9f,$80,$9f

	
	.byte	$af,$80,$af,$80,$af,$80,$af,$80,$af,$80,$8f,$80,$8f,$80,$8f,$80
	.byte	$80,$af,$80,$af,$80,$af,$80,$af,$80,$8f,$80,$8f,$80,$8f,$80,$8f
	.byte	$af,$80,$af,$80,$af,$80,$af,$80,$af,$80,$8f,$80,$8f,$80,$8f,$80
	.byte	$80,$af,$80,$af,$80,$af,$80,$af,$80,$8f,$80,$8f,$80,$8f,$80,$8f
	.byte	$af,$80,$af,$80,$af,$80,$af,$80,$af,$80,$8f,$80,$8f,$80,$8f,$80
	.byte	$80,$af,$80,$af,$80,$af,$80,$af,$80,$8f,$80,$8f,$80,$8f,$80,$8f
	.byte	$af,$80,$af,$80,$af,$80,$af,$80,$af,$80,$8f,$80,$8f,$80,$8f,$80
	.byte	$80,$af,$80,$af,$80,$af,$80,$af,$80,$8f,$80,$8f,$80,$8f,$80,$8f



;***************************************************
; combined depth / angle table
; depth in A angle in B
;***************************************************


angdep


	.word	$2373,$2572,$2771,$2870,$2A6F,$2D6D,$2F6B,$3269,$3566,$3862,$3C5D,$4057,$444D,$4940,$4D2C,$5010
	.word	$50F0,$4DD4,$49C0,$44B3,$40A9,$3CA3,$389E,$359A,$3297,$2F95,$2D93,$2A91,$2890,$278F,$258E,$238D
	.word	$2475,$2574,$2773,$2972,$2B71,$2D6F,$2F6E,$326C,$3569,$3966,$3C61,$415B,$4553,$4A46,$4F31,$5212
	.word	$52EE,$4FCF,$4ABA,$45AD,$41A5,$3C9F,$399A,$3597,$3294,$2F92,$2D91,$2B8F,$298E,$278D,$258C,$248B
	.word	$2476,$2576,$2775,$2974,$2B73,$2D72,$3070,$326F,$356C,$396A,$3D66,$4160,$4659,$4C4C,$5138,$5516
	.word	$55EA,$51C8,$4CB4,$46A7,$41A0,$3D9A,$3996,$3594,$3291,$3090,$2D8E,$2B8D,$298C,$278B,$258A,$248A
	.word	$2478,$2578,$2777,$2976,$2B75,$2D74,$3073,$3372,$3670,$396E,$3D6A,$4266,$475F,$4D54,$5340,$581A
	.word	$58E6,$53C0,$4DAC,$47A1,$429A,$3D96,$3992,$3690,$338E,$308D,$2D8C,$2B8B,$298A,$2789,$2588,$2488
	.word	$247A,$2579,$2779,$2978,$2B78,$2D77,$3076,$3375,$3673,$3A72,$3E6F,$426B,$4866,$4E5C,$554A,$5B21
	.word	$5BDF,$55B6,$4EA4,$489A,$4295,$3E91,$3A8E,$368D,$338B,$308A,$2D89,$2B88,$2988,$2787,$2587,$2486
	.word	$247C,$257B,$277B,$297B,$2B7A,$2D7A,$3079,$3378,$3677,$3A76,$3E74,$4371,$486D,$4F66,$5657,$5E2C
	.word	$5ED4,$56A9,$4F9A,$4893,$438F,$3E8C,$3A8A,$3689,$3388,$3087,$2D86,$2B86,$2985,$2785,$2585,$2484
	.word	$247D,$257D,$277D,$297D,$2B7C,$2D7C,$307C,$337B,$367B,$3A7A,$3E79,$4377,$4974,$5070,$5866,$6040
	.word	$60C0,$589A,$5090,$498C,$4389,$3E87,$3A86,$3685,$3385,$3084,$2D84,$2B84,$2983,$2783,$2583,$2483
	.word	$247F,$257F,$277F,$297F,$2B7F,$2D7F,$307F,$337E,$367E,$3A7E,$3E7E,$437D,$497C,$507B,$5877,$6366
	.word	$639A,$5889,$5085,$4984,$4383,$3E82,$3A82,$3682,$3382,$3081,$2D81,$2B81,$2981,$2781,$2581,$2481
	.word	$2481,$2581,$2781,$2981,$2B81,$2D81,$3081,$3382,$3682,$3A82,$3E82,$4383,$4984,$5085,$5889,$639A
	.word	$6366,$5877,$507B,$497C,$437D,$3E7E,$3A7E,$367E,$337E,$307F,$2D7F,$2B7F,$297F,$277F,$257F,$247F
	.word	$2483,$2583,$2783,$2983,$2B84,$2D84,$3084,$3385,$3685,$3A86,$3E87,$4389,$498C,$5090,$589A,$60C0
	.word	$6040,$5866,$5070,$4974,$4377,$3E79,$3A7A,$367B,$337B,$307C,$2D7C,$2B7C,$297D,$277D,$257D,$247D
	.word	$2484,$2585,$2785,$2985,$2B86,$2D86,$3087,$3388,$3689,$3A8A,$3E8C,$438F,$4893,$4F9A,$56A9,$5ED4
	.word	$5E2C,$5657,$4F66,$486D,$4371,$3E74,$3A76,$3677,$3378,$3079,$2D7A,$2B7A,$297B,$277B,$257B,$247C
	.word	$2486,$2587,$2787,$2988,$2B88,$2D89,$308A,$338B,$368D,$3A8E,$3E91,$4295,$489A,$4EA4,$55B6,$5BDF
	.word	$5B21,$554A,$4E5C,$4866,$426B,$3E6F,$3A72,$3673,$3375,$3076,$2D77,$2B78,$2978,$2779,$2579,$247A
	.word	$2488,$2588,$2789,$298A,$2B8B,$2D8C,$308D,$338E,$3690,$3992,$3D96,$429A,$47A1,$4DAC,$53C0,$58E6
	.word	$581A,$5340,$4D54,$475F,$4266,$3D6A,$396E,$3670,$3372,$3073,$2D74,$2B75,$2976,$2777,$2578,$2478
	.word	$248A,$258A,$278B,$298C,$2B8D,$2D8E,$3090,$3291,$3594,$3996,$3D9A,$41A0,$46A7,$4CB4,$51C8,$55EA
	.word	$5516,$5138,$4C4C,$4659,$4160,$3D66,$396A,$356C,$326F,$3070,$2D72,$2B73,$2974,$2775,$2576,$2476
	.word	$248B,$258C,$278D,$298E,$2B8F,$2D91,$2F92,$3294,$3597,$399A,$3C9F,$41A5,$45AD,$4ABA,$4FCF,$52EE
	.word	$5212,$4F31,$4A46,$4553,$415B,$3C61,$3966,$3569,$326C,$2F6E,$2D6F,$2B71,$2972,$2773,$2574,$2475
	.word	$238D,$258E,$278F,$2890,$2A91,$2D93,$2F95,$3297,$359A,$389E,$3CA3,$40A9,$44B3,$49C0,$4DD4,$50F0
	.word	$5010,$4D2C,$4940,$444D,$4057,$3C5D,$3862,$3566,$3269,$2F6B,$2D6D,$2A6F,$2870,$2771,$2572,$2373

	.end	